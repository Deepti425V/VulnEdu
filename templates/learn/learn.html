{% extends "base.html" %}
{% block content %}
<div style="max-width:1100px;margin:0 auto 30px auto;padding-top:20px;">
<h1 style="color:#63a4ff;">CWEs by Severity</h1>
<div style="margin:32px 0 48px 0; background:#1a2236; border-radius:14px; padding:30px;">
    <div style="font-weight:700; color:#63a4ff; font-size:1.02rem; margin-bottom:10px;">
        Most Critical CWEs (Your Focus)
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;">
        <span>These are the most impactful vulnerability types you track:</span>
        <button id="toggleShowAllCwe"
                style="background:#263159;color:#63a4ff;padding:7px 18px;border-radius:7px;border:none;cursor:pointer;font-weight:600;font-size:0.97em;">
            Show All CWEs
        </button>
    </div>
    <div style="position:relative;height:320px;width:100%; margin-top:16px;">
        {% if cwe_severity.labels|length > 0 %}
        <canvas id="learnCweSeverityChart"></canvas>
        {% else %}
        <div style="color:#a9adc1;text-align:center;padding:30px 0;">
            No CWE data available.
        </div>
        {% endif %}
    </div>
</div>
<div style="display:grid; grid-template-columns: 300px 1fr; gap:36px;">
    <aside style="background:#1a2236; border-radius:14px; padding:18px 0 18px 0;">
        <div style="padding-left:24px;font-weight:700;color:#63a4ff;margin-bottom:10px;">
            CWE List <span id="cweListModeTip" style="color:#94a3b8;font-size:0.93em;font-weight:400;">
            (Your Key Set)</span>
        </div>
        <ul id="cweListColumn" style="list-style:none;padding:0;margin:0;max-height:550px;overflow-y:auto;">
            {% for cwe in key_cwes %}
            <li data-cwe="{{ cwe }}"
                style="padding:8px 24px;cursor:pointer;font-weight:500;color:#e3e7f2;user-select:none;border-left:4px solid transparent;transition: background 0.13s;">
                {{ key_cwe_titles[cwe] }} <span style="color:#94a3b8;font-size:0.9em;">({{ cwe }})</span>
            </li>
            {% endfor %}
        </ul>
        <ul id="cweListFull" style="display:none;list-style:none;padding:0;margin:0;max-height:550px;overflow-y:auto;">
            {% for code, entry in cwe_dict.items() %}
            <li data-cwe="{{ code }}"
                style="padding:8px 24px;cursor:pointer;font-weight:500;color:#e3e7f2;user-select:none;border-left:4px solid transparent;transition: background 0.13s;">
                {{ entry.name }} <span style="color:#94a3b8;font-size:0.9em;">({{ code }})</span>
            </li>
            {% endfor %}
        </ul>
    </aside>
    <section style="background:#1a2236; border-radius:14px; padding:28px 26px; min-height:390px;">
        <div id="cweDetailPanel">
            <p style="color:#a9adc1;">Select a key CWE to see its description, real-world impact, and mitigations.</p>
        </div>
    </section>
</div>
</div>
<script>
window.learnCweSeverityData = {{ cwe_severity | tojson }};
window.learnCweDict = {{ cwe_dict | tojson }};
window.curatedCwes = {{ key_cwes | tojson }};
</script>
<script src="{{ url_for('static', filename='js/learn.js') }}"></script>
{% endblock %}
