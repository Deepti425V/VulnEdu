{% extends "base.html" %}
{% block content %}
<div style="max-width:800px;margin:0 auto;padding-top:60px;text-align:center;">
    <!-- Error Icon -->
    <div style="font-size:4rem;margin-bottom:24px;">‚ö†Ô∏è</div>
    
    <!-- Error Title -->
    <h1 style="color:#f47174;margin:0 0 16px 0;font-size:2rem;">
        Oops! Something went wrong
    </h1>
    
    <!-- Error Message -->
    <div style="background:#1a2236;border-radius:12px;padding:24px;margin-bottom:32px;border-left:4px solid #f47174;">
        <p style="color:#e2e8f0;font-size:1.1em;margin:0;line-height:1.5;">
            {{ error or "An unexpected error occurred. Please try again in a few moments." }}
        </p>
    </div>
    
    <!-- Helpful Information -->
    <div style="background:#232b45;border-radius:12px;padding:24px;margin-bottom:32px;text-align:left;">
        <h3 style="color:#63a4ff;margin:0 0 16px 0;">What you can try:</h3>
        <ul style="color:#a9adc1;margin:0;padding-left:20px;">
            <li style="margin-bottom:8px;">Refresh the page and try again</li>
            <li style="margin-bottom:8px;">Check your internet connection</li>
            <li style="margin-bottom:8px;">Wait a few minutes and try again (the service may be temporarily busy)</li>
            <li style="margin-bottom:8px;">Go back to the <a href="{{ url_for('index') }}" style="color:#63a4ff;">dashboard</a> and navigate from there</li>
        </ul>
    </div>
    
    <!-- Action Buttons -->
    <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap;">
        <a href="javascript:window.location.reload()" 
           style="background:#63a4ff;color:white;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:600;">
            üîÑ Refresh Page
        </a>
        
        <a href="{{ url_for('index') }}" 
           style="background:#263159;color:#63a4ff;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:600;">
            üè† Go to Dashboard
        </a>
        
        <a href="javascript:history.back()" 
           style="background:#263159;color:#a9adc1;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:600;">
            ‚Üê Go Back
        </a>
    </div>
    
    <!-- Technical Info (for debugging) -->
    {% if request.endpoint %}
    <div style="margin-top:40px;padding:16px;background:#151e37;border-radius:8px;font-family:monospace;font-size:0.8em;color:#6b7280;">
        Route: {{ request.endpoint }} | Time: {{ moment().format('YYYY-MM-DD HH:mm:ss') if moment else 'Unknown' }}
    </div>
    {% endif %}
</div>

<script>
// Auto-retry logic for temporary errors
let retryCount = 0;
const maxRetries = 3;

function autoRetry() {
    if (retryCount < maxRetries) {
        retryCount++;
        console.log(`Auto-retry attempt ${retryCount}/${maxRetries}`);
        
        setTimeout(() => {
            window.location.reload();
        }, 5000 * retryCount); // Progressive delay: 5s, 10s, 15s
    }
}

// Only auto-retry for certain error types
const errorMessage = "{{ error | default('') }}".toLowerCase();
if (errorMessage.includes('temporarily unavailable') || 
    errorMessage.includes('service unavailable') || 
    errorMessage.includes('timeout')) {
    
    // Show auto-retry notification
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #232b45;
        color: #63a4ff;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 0.9em;
        z-index: 1000;
        border-left: 4px solid #63a4ff;
    `;
    notification.innerHTML = `‚è≥ Auto-retrying in ${5 * (retryCount + 1)} seconds...`;
    document.body.appendChild(notification);
    
    // Auto-retry after delay
    autoRetry();
    
    // Remove notification after a while
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 4000);
}
</script>
{% endblock %}